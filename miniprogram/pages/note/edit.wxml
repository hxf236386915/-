<view class="container">
  <view class="note-edit">
    <!-- Ê†áÈ¢òËæìÂÖ• -->
    <view class="title-input">
      <input 
        value="{{note.title}}" 
        placeholder="ËæìÂÖ•Ê†áÈ¢ò" 
        bindinput="updateTitle"
      />
    </view>

    <!-- Â∑•ÂÖ∑Ê†è -->
    <view class="toolbar">
      <view class="left">
        <view class="tool-btn" bindtap="insertMarkdown" data-type="bold">
          <text>B</text>
        </view>
        <view class="tool-btn" bindtap="insertMarkdown" data-type="italic">
          <text>I</text>
        </view>
        <view class="tool-btn" bindtap="insertMarkdown" data-type="link">
          <text>üîó</text>
        </view>
        <view class="tool-btn" bindtap="insertMarkdown" data-type="list">
          <text>‚Ä¢</text>
        </view>
        <view class="tool-btn" bindtap="insertMarkdown" data-type="task">
          <text>‚òê</text>
        </view>
        <view class="tool-btn" bindtap="insertMarkdown" data-type="code">
          <text>{ }</text>
        </view>
      </view>
      <view class="right">
        <view class="tool-btn" bindtap="chooseImage">
          <text>üñºÔ∏è</text>
        </view>
        <view class="tool-btn" bindtap="chooseFile">
          <text>üìé</text>
        </view>
        <view class="tool-btn {{isPreview ? 'active' : ''}}" bindtap="togglePreview">
          <text>üëÅÔ∏è</text>
        </view>
      </view>
    </view>

    <!-- ÁºñËæëÂå∫Âüü -->
    <view class="content" hidden="{{isPreview}}">
      <textarea 
        value="{{note.content}}" 
        placeholder="ÂºÄÂßãÁºñÂÜô..." 
        bindinput="updateContent"
        style="height: {{contentHeight}}px"
      />
    </view>

    <!-- È¢ÑËßàÂå∫Âüü -->
    <view class="preview" hidden="{{!isPreview}}">
      <rich-text nodes="{{htmlContent}}"></rich-text>
    </view>

    <!-- ÈôÑ‰ª∂ÂàóË°® -->
    <view class="attachments" wx:if="{{files.length > 0 || images.length > 0}}">
      <!-- ÂõæÁâáÂàóË°® -->
      <view class="images" wx:if="{{images.length > 0}}">
        <view class="section-title">ÂõæÁâá</view>
        <view class="image-list">
          <view class="image-item" wx:for="{{images}}" wx:key="index">
            <image 
              src="{{item.path}}" 
              mode="aspectFill" 
              bindtap="previewImage" 
              data-index="{{index}}"
            />
            <view class="delete-btn" wx:if="{{!item.uploading}}" bindtap="deleteFile" data-type="image" data-index="{{index}}">
              <text>√ó</text>
            </view>
            <view class="loading" wx:if="{{item.uploading}}">‰∏ä‰º†‰∏≠...</view>
          </view>
        </view>
      </view>

      <!-- Êñá‰ª∂ÂàóË°® -->
      <view class="files" wx:if="{{files.length > 0}}">
        <view class="section-title">ÈôÑ‰ª∂</view>
        <view class="file-list">
          <view class="file-item" wx:for="{{files}}" wx:key="index">
            <view class="file-info">
              <text class="file-name">{{item.name || 'Êñá‰ª∂' + (index + 1)}}</text>
              <text class="loading" wx:if="{{item.uploading}}">‰∏ä‰º†‰∏≠...</text>
            </view>
            <view class="delete-btn" wx:if="{{!item.uploading}}" bindtap="deleteFile" data-type="file" data-index="{{index}}">
              <text>√ó</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>
</view> 